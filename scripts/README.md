# Helper script documentation

## flush_eq_data.py

This script is used to flush partial data submissions out of EQ and send them downstream to SDX.  This script allows
you to flush a single response as long as you know 4 bits of information, the eq_id, formtype, collection_exercise_id
and ru_ref (with checkletter)

In order to run it, you'll need to have a file named eq-keys.json (though the script will allow you to change the file
with the --keys flag) that contains the EQ keys in json format.  This can be retrieved by looking at the frontstage
secrets.

Once you have that, you'll be able to run the script, here is an example of how to run it:
```bash
cd scripts
pipenv run python flush_eq_data.py preprod "rsi" "0203" "c3b0aa25-c626-4e2c-b39e-84aa695d7f71" "19021417983n"
```

This should print out the status code.  It's possible for it to 'fail' with a 404 and that not be a bad thing.  EQ looks
in its answerstore for a submission that matches the criteria.  It's possible the details you gave it were correct but
EQ just doesn't have it in its answer store.

## generate_csv_for_emails.py

This script is used to take input from the following 2 files:
 - Print file (generated by the actionexporter service and contains enrolment codes)
 - Respondent/Business excel file (generated by the business and contains contact details and the email 
 addresses we're sending to)

In addition, the script takes a number of arguments:
- Survey name.  This relates to a map in the script that contains the survey name and phone number.
- Respondent period (Takes the form of "<Month> <Year>" e.g., "April 2020")
- Return by date (Takes the form of "<Day> <Month> <Year>" e.g., "07 May 2020")


A csv file is generated from these that will be uploaded to gov.notify(https://www.notifications.service.gov.uk/)
to send the ras-email-enrolment-code email.  This is currently being done as a special case during the covid-19 situation
as businesses aren't able to receive their enrolment code for surveys as they're not present at their registered office
address.

To run the script, do the following:
```bash
cd scripts
pipenv run python generate_csv_for_emails.py <business_filename> <print_filename> construction "April 2020" "07 May 2020"
```

This will generate a file called `enrolment_email_details.csv` which can be uploaded to gov notify via the
web interface to send emails.

Included in this folder is a file called `example_business_file.xlsx` which mimics the excel file the business
generates for us and can be used to generate example files.  There is also `example_print_file.csv` to mimic the print file
for testing.

