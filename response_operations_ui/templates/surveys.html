{% extends "layouts/base.html" %}
{% from "components/panel/_macro.njk" import onsPanel %}
{% from "components/table/_macro.njk" import onsTable %}

{% set page_title = "Surveys" %}

{% block main %}
  {% if info_message %}
    {% call
      onsPanel({
          "type": "success",
          "classes": "u-mb-s",
          "id": "collection-instrument-success"
      })
    %}
      {{ info_message }}
    {% endcall %}
  {% endif %}

  <h1 name="page-surveys-title">Surveys</h1>
  
  {% set surveyTableData = {
      "table_class": 'table--responsive table--dense',
      "id": 'tbl-surveys'
    }
  %}

  {% do surveyTableData | setAttribute("ths", [
      { 
          "value": "ID"
      },
      { 
          "value": "Title"
      },
      { 
          "value": "Abbreviation"
      },
      { 
          "value": "Legal basis"
      },
      { 
          "value": ""
      }
    ]) 
  %}

  {% set surveyTableDataRows = [] %}

  {% for survey in survey_list %}
    {% do surveyTableDataRows.append(
      {
        "tds": [
          {
            "value": survey.surveyRef,
            "data": "ID"
          },
          {
            "value": '<a href="/surveys/' + survey.shortName.replace(' ', '') + '" name="survey-link-' + survey.shortName + '">' + survey.longName + '</a>',
            "data": "Title"
          },
          {
            "value": survey.shortName,
            "data": "Abbreviation"
          },
          {
            "value": survey.legalBasis,
            "data": "Legal basis"
          },
          {
            "value": '<form action="' + url_for("surveys_bp.view_survey_details", short_name=survey.shortName, long_name=survey.longName, legal_basis=survey.legalBasis, survey_ref=survey.surveyRef) + '" method="get"><a class="edit-icon" href=# id="edit-survey-details-' + survey.surveyRef + '" onclick="this.parentNode.submit()"></a></form>',
            "data": "Edit"
          }
        ]
      }
    ) %}
  {% endfor %}
  
  {% do surveyTableData | setAttribute("trs", surveyTableDataRows) %}
  
  {{
    onsTable(surveyTableData)
  }}
{% endblock %}
