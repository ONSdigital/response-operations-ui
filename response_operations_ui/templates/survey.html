{% extends "layouts/base.html" %}
{% block page_title %}{{survey.shortName}} | Surveys | Survey Data Collection{% endblock %}

{% block main %}
<div role="main" id="main" class="page__main">
{% if updated_ce_message %}
  <div class="panel panel--simple panel--success">
    <div id="updated_ce_message" class="panel__body">
      Collection exercise details updated
    </div>
  </div>
{% endif %}
{% if created_ce_message %}
  <div class="panel panel--simple panel--success">
    <div id="created_ce_message" class="panel__body">
      Collection exercise created
    </div>
  </div>
{% endif %}
<h1 class="jupiter" name="page-survey-title">{{survey.longName}}</h1>

  <div class="grid">
    <div class="grid__col col-12@l">
      <div class="">
        <dl class="survey-info info-panel" id="survey-attributes">
          <dt class="survey-info__title">
            Survey ID:
          </dt>
          <dd class="survey-info__data" name="survey-id">
            {{survey.surveyRef}}
          </dd>
          <dt class="survey-info__title">
            Survey title:
          </dt>
          <dd class="survey-info__data" name="survey-title">
            {{survey.longName}}
          </dd>
          <dt class="survey-info__title">
            Abbreviation:
          </dt>
          <dd class="survey-info__data" name="survey-abbreviation">
            {{survey.shortName}}
          </dd>
          <dt class="survey-info__title">
            Legal basis:
          </dt>
          <dd class="survey-info__data" name="survey-legal-basis">
            {{survey.legalBasis}}
          </dd>
        </dl>
      </div>
      <div class="ce-list">
        <h2 class="saturn u-pt-m">Collection exercises for {{survey.shortName}}</h2>
        <div class="u-mb-l">
          <a href="/surveys/{{survey.surveyRef}}-{{survey.shortName}}/create-collection-exercise"
             name="create-collection-exercise-link">Create collection exercise</a>
        </div>
        <table class="table__dense" summary="Collection exercises for the survey" id="tbl-collection-exercise">
          <thead class="table--head">
            <tr class="table--row">
              <th scope="col" class="table--header--cell tbl-ce-period">
                Period
              </th>
              <th scope="col" class="table--header--cell tbl-ce-respondent-info">
                Respondent sees
              </th>
              <th scope="col" class="table--header--cell tbl-ce-status">
                Status
              </th>
              <th scope="col" class="table--header--cell tbl-ce-status">
                Sample
              </th>
              <th scope="col" class="table--header--cell tbl-ce-status">
                Report (CSV)
              </th>
              <th scope="col" class="table--header--cell tbl-ce-status">
                MPS
              </th>
              <th scope="col" class="table--header--cell tbl-ce-status">
                Go live
              </th>
              <th scope="col" class="table--header--cell tbl-ce-status">
                Return by
              </th>
            </tr>
          </thead>
          <tbody>
            {% for exercise in collection_exercises %}
              <td class="table--cell tbl-ce-period" name="tbl-ce-period">
                <a href="/surveys/{{ survey.shortName.replace(' ', '') }}/{{ exercise.exerciseRef }}"
                   name="ce-link-{{exercise.exerciseRef}}">
                  {{exercise.exerciseRef}}
                </a>
              </td>
              <td class="table--cell tbl-ce-respondent-info" name="tbl-ce-shown-as">
                {{exercise.userDescription}}
              </td>
              <td class="table--cell tbl-ce-status" name="tbl-ce-status">
                {{exercise.state}}
              </td>
              <td class="table--cell tbl-ce-status" name="tbl-ce-status">
                {{ exercise.sample_summary and exercise.sample_summary.totalSampleUnits or "" }}
              </td>
              <td class="table--cell tbl-ce-status" name="tbl-ce-report">
                {% if exercise.state|upper == "LIVE" %}
                  <a class="download" href="{{ url_for('collection_exercise_bp.response_chasing', ce_id=exercise.id, survey_id=survey.id) }}" target="_blank">Response chasing</a>
                {% endif %}
              </td>
              <td class="table--cell tbl-ce-status" name="tbl-ce-status">
                {{ exercise.events.mps and exercise.events.mps.date or "" }}
              </td>
              <td class="table--cell tbl-ce-status" name="tbl-ce-status">
                {{ exercise.events.go_live and exercise.events.go_live.date or "" }}
              </td>
              <td class="table--cell tbl-ce-status" name="tbl-ce-status">
                {{ exercise.events.return_by and exercise.events.return_by.date or "" }}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
