{% extends "layouts/base.html" %}

{% set subject = messages[-1]["subject"] or "No Subject" %}

{% block page_title %} {{ subject }} | Survey Data Collection {% endblock %}

{% block main %}

<h1 class="saturn" name="page-messages-title">{{ subject }}</h1>

<div class="secure-message-conversation block">
    <div class="secure-message-sent-message-meta">
         <div class="secure-message--meta venus"><span class="secure-message-conversation-meta__label">Survey: </span><span id="survey">{{ messages[0].get('survey') }} {{ messages[0].get('survey_ref') }}</span></div>
         <div class="secure-message--meta venus"><span class="secure-message-conversation-meta__label">RU Ref: </span><span id="ruref">{{ messages[0].get('ru_ref') }}</span></div>
         <div class="secure-message--meta venus"><span class="secure-message-conversation-meta__label">Business: </span><span id="ru">{{ messages[0].get('business_name') }}</span></div>
    </div>
    {% for message in messages %}
       <div class="secure-message-sent-message" {% if loop.last %}id="latest-message"{% endif %}>
    {% if message.get('internal') == True %}
        <div name="sm-from-ons" id="sm-from-ons-{{ loop.index }}" class="secure-message-sent-message-meta sm-from-ons">
    {% else %}
        <div name="sm-from-respondent" id="sm-from-respondent-{{ loop.index }}" class="secure-message-sent-message-meta sm-from-respondent">
    {% endif %}
            <span class="secure-message-sent-message-meta-from venus">
                From:
                <span name="sm-from-user" id="sm-from-user-{{ loop.index }}" style="display:inline;">{{ message.get('username') }}</span>
            </span>
            <span class="secure-message-sent-message-meta-from mercury">
                Sent:
                <span name="sm-sent-date" id="sm-sent-date-{{ loop.index }}" style="display:inline;">{{ message.get('sent_date') }}</span>

            </span>
        </div>
        <div class="secure-message-sent-message-body mars">
            <span style="white-space:pre-line">{{ message.get('body') }}</span>
        </div>
    </div>
    {% endfor %}
        </div>
        <!--TODO Add in the reply box -->
    </div>
{% endblock %}
