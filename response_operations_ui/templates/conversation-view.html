{% extends "layouts/base.html" %}

{% block page_title %} {{ messages[0]["subject"] or "No Subject" }} | Survey Data Collection {% endblock %}

{% block main %}

<h1 class="saturn" name="page-messages-title">{{ messages[0]["subject"] or "No Subject" }}</h1>

<div class="secure-message-conversation block">
    <div class="secure-message-sent-message-meta">
         <div class="secure-message--meta venus"><span class="sm-form-meta-label">Survey: </span><span id="survey">{{ messages[0].get('survey') }}</span></div>
         <div class="secure-message--meta venus"><span class="sm-form-meta-label">RU Ref: </span><span id="ruref">{{ messages[0].get('ru_ref') }}</span></div>
         <div class="secure-message--meta venus"><span class="sm-form-meta-label">Business: </span><span id="ru">{{ messages[0].get('business_name') }}</span></div>
         <div class="secure-message--recipient venus"><span class="sm-form-recipient-label">To: </span><span id="recipient">{{ messages[0].get('to') }}</span></div>
    </div>
    {% for message in messages %}
       <div class="secure-message-sent-message">
    {% if message.get('internal') == True %}
        <div name="sm-from-ons-{{ loop.index }}" class="secure-message-sent-message-meta sm-from-ons">
    {% else %}
        <div name="sm-from-respondent-{{ loop.index }}" class="secure-message-sent-message-meta sm-from-respondent">
    {% endif %}
            <span class="secure-message-sent-message-meta-from venus">
                <span id="from">From:</span>
                {{ message.get('username') }}
            </span>
            <span class="secure-message-sent-message-meta-from mercury">
                <span id="sent">Sent:</span>
                {{ message.get('sent_date') }}
            </span>
        </div>
        <div class="secure-message-sent-message-body mars">
            <p>{{ message.get('body') }}</p>
        </div>
    </div>
    {% endfor %}
        </div>
        <!--TODO Add in the reply box -->
    </div>
    <div id="latest-message"></div>
{% endblock %}