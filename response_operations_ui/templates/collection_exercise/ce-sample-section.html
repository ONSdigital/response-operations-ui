<section class="ons-u-mt-s">
    {% set surveyEditPermission = hasPermission('surveys.edit') %}
    {% set tblHeaders =  
          [ 
              { 
                  "value": "Sample file",
                  "thClasses": "ons-u-fs-r--b"
              },
          ]
    %}
    {% set surveyTableData = {
        "variants": ['compact', 'responsive'],
        "id": "sample-table",
        "caption": 'Sample summary',
        "hideCaption": true,
        "ths": tblHeaders,
    } %}
  
    {% if sample %}
        {% if sample.state == 'ACTIVE' or sample.state == 'COMPLETE' %}
            {% do tblHeaders.append(
                {
                    "value": "Sample loaded: " + '<em>' + sample.ingestDateTime[:-7] + '</em>' + sample.ingestDateTime[-7:],
                    "thClasses": "ons-u-fs-r",
                    "numeric": "true"
                }
             )%}
            {% set surveyTableDataRows = [
                {
                    "tds": [
                        {
                            "value": "Total businesses"
                        },
                        {
                            "value": sample.totalSampleUnits,
                            "name": "total-businesses",
                            "numeric": "true"
                        }
                    ]
                },
                {
                    "tds": [
                        {
                            "value": "Collection instruments needed"
                        },
                        {
                            "value": sample.expectedCollectionInstruments,
                            "name": "total-ci",
                            "numeric": "true"
                        }
                    ]
                },
                {
                    "tds": [
                        {
                            "value": ""
                        },
                        {
                            "value": '<a href="' + url_for('collection_exercise_bp.get_view_sample_ci', short_name=survey.shortName, 
                            period=ce.exerciseRef) + '" id="create-event-date-go-live">Replace sample file</a>',
                            "tdClasses": "ons-u-ta-right"
                        }
                    ]
                }
            ] %}
            
            {% do surveyTableData | setAttribute("trs", surveyTableDataRows) %}
        {% endif %}
            {{
                onsTable(surveyTableData)
            }}
        
        {% if 'INIT' == sample.state %}
          {% if sample_load_status %}
            {% set status = '(' ~ sample_load_status.currentTotal ~ ' / '  ~sample_load_status.expectedTotal ~ ' loaded) ' %}
          {% endif %}
              <div class="ons-u-mb-m">
                  <div class="ons-u-fs-r">
                      Loading {{ status }}â€¦ <span class="ons-u-ml-xs"><a href="/surveys/{{survey.shortName}}/{{ce.exerciseRef}}?show_msg=true">Refresh to see progress</a></span>
                  </div>
              </div>
        {% elif 'FAILED' == sample.state %}
            {% call
                onsPanel({
                    "type": "error",
                    "classes": "ons-u-mb-l"
                })
            %}
                {{ sample.notes }}
            {% endcall %}
        {% endif %}
    {% else %}
        {% set surveyTableDataRows = [
            {
                "tds": [
                ]
            },
        ] %}
        {% do surveyTableData | setAttribute("trs", surveyTableDataRows) %}
    
        {{
            onsTable(surveyTableData)
        }}
    {% endif %}

    {% if not sample and (not locked) and surveyEditPermission and (not 'INIT' == sample.state)%}
          {% set sampleButtonText = 'Upload sample file' %}
          {% set sampleButtonLink = url_for('collection_exercise_bp.get_upload_sample_file', short_name=survey.shortName, period=ce.exerciseRef) %}
        {{
            onsButton({
                "text": sampleButtonText,
                "id": 'btn-upload-sample-file',
                "classes": "ons-u-mb-l",
                "submitType": 'timer',
                "variants": ['secondary', 'small'],
                "url": sampleButtonLink,
                "noIcon": 'true'
            })
        }}
  {% endif %}
</section>
