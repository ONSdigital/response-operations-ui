{"version":3,"file":"js/main.min.js","mappings":"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","sources":["webpack://response-operations-ui/./response_operations_ui/assets/js/includes/read-csv.js","webpack://response-operations-ui/./response_operations_ui/assets/js/includes/validate-ci.js","webpack://response-operations-ui/webpack/bootstrap","webpack://response-operations-ui/webpack/runtime/compat get default export","webpack://response-operations-ui/webpack/runtime/define property getters","webpack://response-operations-ui/webpack/runtime/hasOwnProperty shorthand"],"sourcesContent":["window.readCSV = {\n    __private__: {}\n};\n\nwindow.readCSV.__private__.getOutputTemplate = function(businessCount, ciCount) {\n    let preview = '';\n\n    preview += '<div class=\\'panel panel--info\\'>';\n    preview += '  <div class=\\'panel__header\\'>';\n    preview += '    <h3 class=\\'u-fs-r--b u-mb-no\\'>Sample contents</h3>';\n    preview += '  </div>';\n    preview += '  <div class=\\'panel__body\\'>';\n    preview += '    <div id=\\'sample-preview-businesses\\'>Number of businesses: ' + businessCount + '</div>';\n    preview += '    <div id=\\'sample-preview-ci\\'>Collection instruments: ' + ciCount + '</div>';\n    preview += '  </div>';\n    preview += '</div>';\n\n    return preview;\n};\n\nwindow.readCSV.__private__.renderUI = function(businessCount, ciCount) {\n    document.getElementById('sample-preview').innerHTML = window.readCSV.__private__.getOutputTemplate(businessCount, ciCount);\n    document.getElementById('btn-upload-sample').disabled = false;\n};\n\nwindow.readCSV.__private__.errorHandler = function(evt) {\n    if (evt.target.error.name == 'NotReadableError') {\n        alerts.error('Error Uploading file', 'The selected file was not readable.');\n    }\n};\n\nwindow.readCSV.__private__.browserHasFileLoaderCapability = function() {\n    return window.hasOwnProperty('FileReader');\n};\n\nwindow.readCSV.__private__.processFile = function(event, classifiers) {\n    const csv = event.target.result;\n    const allTextLines = csv.split(/\\r\\n|\\n/);\n    const classifierColumn = [];\n    const lines = [];\n    let ciCount;\n\n    while (allTextLines.length) {\n        const line = allTextLines.shift().split(':');\n        if (line && line.length && line[0]) {\n            lines.push(line);\n        }\n    }\n\n    if (classifiers.indexOf('RU_REF') > -1) {\n        ciCount = lines.length; // each line should be a distinct RU_REF (sampleUnitRef)\n    } else if (classifiers.indexOf('FORM_TYPE') > -1) {\n        // Put the form types into their own separate array, so we can interrogate it faster\n        for (let i = 0; i < lines.length; i++) {\n            classifierColumn.push(lines[i][lines[i].length - 2]);\n        }\n\n        ciCount = classifierColumn.filter(function(val, i, arr) {\n            return arr.indexOf(val) === i;\n        }).length;\n    }\n\n    window.readCSV.__private__.renderUI(lines.length, ciCount);\n};\n\nwindow.readCSV.handleFiles = function(files, classifiers) {\n    if (window.readCSV.__private__.browserHasFileLoaderCapability()) {\n        const reader = new FileReader();\n\n        reader.onload = function(evt) {\n            window.readCSV.__private__.processFile(evt, classifiers);\n        };\n\n        reader.onerror = window.readCSV.__private__.errorHandler;\n\n        reader.readAsText(files[0]);\n    } else {\n        alerts.warn('Your browser does not support file uploading.  Uploading of samples will not be possible.');\n    }\n};\n\nwindow.readCSV.handleFileUpload = function() {\n    document.getElementById('btn-upload-sample').classList.add('is-loading');\n    document.getElementById('btn-upload-sample').style.pointerEvents = \"none\";\n    document.getElementById('btn-upload-sample').disabled = false;\n};\n","window.validateCI = {\n    __private__: {\n        nodeClassesChange: function nodeClassesChange(node, classes, action) {\n            if (typeof classes === 'string') classes = [classes];\n\n            if (!(node instanceof HTMLElement)) throw new Error('Expected HTMLElement as first argument');\n\n            if (!Array.isArray(classes)) throw new Error('Expected Array as second argument');\n\n            if (['add', 'remove'].indexOf(action) === -1) throw new Error('Expected add or remove as third parameter');\n\n            classes.map(c => node.classList[action](c));\n        },\n\n        arrayLikeToArray: function arrayLikeToArray(arrayLike) {\n            if (!('length' in arrayLike) && !('size' in arrayLike)) throw new Error('Expected array-like object as argument');\n\n            return Array.prototype.slice.call(arrayLike);\n        },\n    },\n\n    checkCI: function checkCI(file) {\n        const type = file.type;\n        const errorPanel = document.getElementById('ciFileErrorPanel');\n        const errorPanelBody = document.getElementById('ciFileErrorPanelBody');\n        const button = document.getElementById('btn-load-ci');\n\n        const fileIsODS = (type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') || (type === 'application/vnd.ms-excel');\n        const mainAction = fileIsODS ? 'remove' : 'add';\n        const contraAction = fileIsODS ? 'add' : 'remove';\n\n        this.__private__.nodeClassesChange(errorPanel, ['ons-panel', 'ons-panel--simple', 'ons-panel--error'], mainAction);\n        this.__private__.nodeClassesChange(errorPanelBody, ['ons-panel__body'], mainAction);\n        this.__private__.nodeClassesChange(button, ['ons-btn--disabled'], contraAction);\n\n        this.__private__.arrayLikeToArray(errorPanelBody.querySelectorAll('p:not(.field)')).forEach(el => {\n            this.__private__.nodeClassesChange(el, ['hidden'], contraAction);\n            this.__private__.nodeClassesChange(button, ['ons-btn--disabled'], mainAction);\n        });\n    },\n\n    checkSelectedCI: function checkSelectedCI(files) {\n        // Check for the various File API support.\n        if (window.FileReader) {\n            // FileReader is supported.\n            validateCI.checkCI(files[0]);\n        }\n    }\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))"],"names":["window","readCSV","__private__","getOutputTemplate","businessCount","ciCount","preview","renderUI","document","getElementById","innerHTML","disabled","errorHandler","evt","target","error","name","alerts","browserHasFileLoaderCapability","hasOwnProperty","processFile","event","classifiers","allTextLines","result","split","classifierColumn","lines","length","line","shift","push","indexOf","i","filter","val","arr","handleFiles","files","reader","FileReader","onload","onerror","readAsText","warn","handleFileUpload","classList","add","style","pointerEvents","validateCI","nodeClassesChange","node","classes","action","HTMLElement","Error","Array","isArray","map","c","arrayLikeToArray","arrayLike","prototype","slice","call","checkCI","file","_this","type","errorPanel","errorPanelBody","button","fileIsODS","mainAction","contraAction","this","querySelectorAll","forEach","el","checkSelectedCI","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop"],"sourceRoot":""}